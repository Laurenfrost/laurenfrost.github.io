---
title: 论文阅读：Towards Transparent CPU Scheduling
date: 2020-08-18 17:31:35
tags: 论文
category: 操作系统
---

最近在看 [OSTEP](http://pages.cs.wisc.edu/~remzi/OSTEP/)，作者在进程调度部分推荐了该论文：

*Joseph T. Meehean*, [Towards Transparent CPU Scheduling](http://www.cs.wisc.edu/adsl/Publications/meehean-thesis11.pdf), UNIVERSITY OF WISCONSIN–MADISON, 2011  

---

本文提出用科学的方法对CPU调度器有更深入的了解; 我们使用这种方法来解释和理解CPU调度器有时不稳定的行为。这种方法首先将受控的工作负载引入商品操作系统，并观察CPU调度器的行为。通过这些观察，我们能够推断底层CPU调度策略，并创建预测调度行为的模型。

在将科学分析应用于CPU调度器方面，我们已经取得了两项进展。首先，CPU的未来将是嵌入到CPU调度器和用户空间控制器中的预测调度模型的组合，后者使用来自这些模型的反馈来指导应用程序。我们基于两种不同的调度范例(分时和比例-份额)，为两种不同的Linux调度器(CFS和O(1))开发了这些预测模型。通过三个不同的案例研究，我们演示了应用程序可以使用我们的预测模型将来自低重要性应用程序的干扰减少70%以上，将web服务器的供应不足减少一个数量级，并执行与CPU调度器相矛盾的调度策略。

我们的第二个贡献是Harmony。这是一个框架和一组实验，用于从普通操作系统中提取多处理器调度策略。我们使用这个工具提取和分析三个Linux调度器的策略:O(1)、CFS和BFS。这些调度器通常执行截然不同的策略。从高层次的角度来看，O(1)调度器谨慎地选择要迁移的进程和强值处理器亲缘性（*原文：strongly values processor affinity*）。相反，CFS则不断地寻找更好的平衡，最终选择了随机迁移进程。而BFS则非常看重公平性，经常忽略处理器关联性。

---

## 导论

> *把自己渴望的东西托付给漫不经心的希望，用至高无上的理由把自己不渴望的东西推到一边，这是人类的习惯。*   
> ————*修西得底斯*  

目前，应用程序、开发人员和系统研究人员都将最佳工作CPU调度器视为可靠的黑箱。依赖这些调度器来提供底层但至关重要的服务。在过去的几十年里，处理器快速增长的性能支持了这种依赖和映像。

单处理器速度不断增长的结束意味着这些假设应该重新考虑。如果对中等负载下的CPU调度器进行更仔细的检查，就会发现它们可以提供反复无常的服务，并实现与依赖于它们的应用程序冲突的资源争用策略。这种看似不稳定的行为对应用程序的可感知可靠性有可怕的后果;它会导致缓慢的响应时间，病态的行为，甚至应用程序失败。

在这项工作中，我们建议采取科学的方法来理解CPU调度程序;我们开始通过收集观察、生成假设和生成预测模型来揭开CPU调度器的神秘面纱。例如，对CPU调度的进一步研究表明，它有时不稳定的行为并不是不可预测的，而只是几个善意策略的不幸组合结果。这种方法产生的观察结果和预测模型使CPU调度对应用程序更加透明(并且可由应用程序控制)，并使esearchers能够改进或细化调度策略。

本文讨论了我们在科学分析CPU调度方面所做的两个改进。在第一个“CPU Futures”中，我们创建并演示嵌入到CPU调度器中的预测模型的价值。应用程序使用这些预测模型来主动引导两个当代的Linux CPU调度程序实现它们所期望的调度策略。在第二部分，我们实现了一个多处理器CPU调度观察的收集框架。然后，我们使用这个名为Harmony的框架从三个Linux CPU调度器(O(1)、CFS和BFS)提取CPU调度策略。

本章对驱动这些理论的思想进行了高层次的概述。第一部分讨论CPU调度日益增加的重要性。下一节将介绍黑箱CPU调度造成的困难。在本节之后，将使用科学的方法进行更广泛的讨论，以提高CPU调度器的透明度。最后，我们对本文的结构进行了概述。

### CPU 调度的重要性

在过去的15年里，CPU调度算法的进步已经很大程度上与处理器快速增长的速度无关(有些例外[27,48,56,65])。在多媒体应用程序的实时调度领域中，许多有趣的工作只是被新处理器的速度超越了[24,25,26,28]。每一台现代的台式电脑都可以轻松地播放流媒体，而无需专门为此目的而设计的研究技术的帮助。事实上，许多电脑依然在使用80年代和90年代早期开发的分时调度技术来播放实时媒体。那么，为什么系统研究团体应该投入时间和金钱来研究任务调度呢?

答案是免费的硬件之旅已经结束，单核处理器速度已在2003年达到顶峰[63]。当前硬件的趋势是更多的处理器核数，而不是更快的单核处理器，这意味着CPU调度再次重要了起来。为了改进多核处理器下应用程序的性能，需要改进CPU调度算法。

多核处理器不会像更快的单核处理器那样自动地为应用程序提供性能改进。相反，必须重新设计应用程序以增加其并行性。同意，CPU调度器也必须要重新设计，以最大限度地提高这种新的应用程序并行性的性能。CPU调度策略(在很大程度上是一种机制)对于在自己的机器上运行的串行应用程序并不重要。然而，现在，一个应用程序可能在一台机器上与自身的多个并发实例竞争/合作。在这个场景中，CPU调度就变得非常重要。如果应用程序的某些部分没有响应，而另一些部分运行良好，那么应用程序可能会出现无响应、不稳定甚至造成严重故障。

如果CPU未被充分利用，CPU调度几乎无关紧要。事实上，在未充分利用的CPU上，调度器的存在只会影响调度延迟。人们最初的期望是，增加的每台机器的处理器数量可以减少潜在的CPU争用，从而减少对良好CPU调度的需求。然而，冗余硬件的增加是与服务器整合（*原文：server consolidation*）的增加同时发生的，这重新引入了CPU争用的可能性。

为了增加利润并提高(集群的)吞吐量，服务器整合可能会减少应用程序的硬件分配，直到应用程序以接近其分配的硬件容量运行为止。这种对资源分配的精确调整将部分调度问题转移到了应用程序的操作系统上。在接近系统满负荷的情况下运行意味着即使负载稍有增加，也可能使系统处于过载状态。而一旦系统过载，CPU调度就变得至关重要。因为此时CPU调度器必须仔细决定如何分配其有限的资源。

### 不透明的cpu调度程序

普通CPU调度器非常不透明。现在正在运行的大部分系统中，来自CPU调度器的主要反馈只是其策略的直接结果：每个应用程序分配了多少CPU。虽然总比没有好，但这种反馈传达的信息非常少。它没有提供关于为什么给应用程序一个特定分配的信息。这就是应用程序想要的吗？是否存在CPU争用？由于CPU争用，应用程序的运行速度会慢多少？如果应用程序有更高或更低的优先级，它会收到什么？

这种不透明性对用户、应用程序、应用程序开发人员和系统研究人员产生了负面影响。用户和应用程序无法确定他们的程序运行将怎样被CPU调度和争用所影响。对于运行缓慢的应用程序，用户甚至可能根本无法判断这是CPU本身的锅还是CPU调度器的锅。应用程序无法确定系统是否能够支持其当前的并行度级别，应用程序无法确定是否应该增加或减少并行度，更不要说确定增加或减少多少。这些问题常常使CPU调度器显得不可预测和不一致。

对CPU调度器的离线分析证明，它的不透明性既有所增加，亦有所减少。一般操作系统的单处理器调度策略通常有很好的文档，主要在教科书[20,35,88,89,108,111]中。然而，这些操作系统的多处理器调度策略常常缺少文档记录或者根本没有文档记录；发行主发行版Linux调度器时，没有任何关于其多处理器调度策略的文档。此外，常用的单处理器和多处理器调度策略的文档常常以实现为重点。这让读者大致了解了如何构建调度程序，但无法了解在给定特定工作负载时它的行为。

应用程序开发人员无法在其应用程序中有效地构建并行性，因为他们无法预测CPU调度器将如何管理这种并行性。相反，他们必须使用试验和错误来设计他们的应用程序。这种不确定性在实现结束时增加了一个额外的递归调试步骤，而不是允许应用程序设计人员基于很容易理解的CPU调度器参数构建应用程序。

